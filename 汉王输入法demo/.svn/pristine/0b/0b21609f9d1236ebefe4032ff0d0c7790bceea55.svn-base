//
//  GZSettingBoard.m
//  HanvonKeyboard
//
//  Created by hanvon on 2017/11/21.
//  Copyright © 2017年 hanvon. All rights reserved.
//

#import "GZSettingBoard.h"

@implementation GZSettingBoard

- (instancetype)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        //创建view
        self.backgroundColor = [UIColor whiteColor];
        self.layer.borderWidth = 0.5;
        self.layer.borderColor = [RGBA(210, 213, 219, 1.0) CGColor];

        [self createUI];
        [self setData];
    }
    return self;
}

- (void)changeViewFrame:(CGRect)newFrame {

    self.frame = newFrame;

    //键盘布局 水平间距5 垂直间距7
    //键盘布局 顶部间距3 底部间距3
    CGFloat spaceX = 5.0;
    CGFloat spaceY = 7.0;
    CGFloat top = 3.0;
    //CGFloat bottom = 3.0;
    CGFloat width = 80;
    CGFloat height = 80;
    NSArray *titles = [NSArray arrayWithObjects:@"联想输入",@"详细设置", nil];
    int num = (int)floorf((self.frame.size.width-spaceX)/(width+spaceX)); //一行能放的按钮个数
    int row = (int)ceilf(titles.count/num) + 1; //最多能用几行
    for (int i=0; i<row; i++) {
        int max = (int)titles.count - i*num;
        for (int j=0; j<max; j++) {
            UIButton *button = (UIButton*)[self viewWithTag:111 + i*num + j];
            button.frame = CGRectMake(spaceX + j*(spaceX+width), top + i*(height+spaceY), width, height);
        }
    }
}



#pragma mark -- 创建UI
- (void)createUI {
    //键盘布局 水平间距5 垂直间距7
    //键盘布局 顶部间距3 底部间距3
    CGFloat spaceX = 5.0;
    CGFloat spaceY = 7.0;
    CGFloat top = 3.0;
    CGFloat bottom = 3.0;

    NSArray *titles = [NSArray arrayWithObjects:@"联想输入",@"详细设置", nil];
    NSArray *images = [NSArray arrayWithObjects:@"set_association",@"set_set", nil];
    NSArray *images_select = [NSArray arrayWithObjects:@"set_association-select",@"set_set-select", nil];
    CGFloat width = 80;
    CGFloat height = 80;

    int num = (int)floorf((self.frame.size.width-spaceX)/(width+spaceX)); //一行能放的按钮个数
    int row = (int)ceilf(titles.count/num) + 1; //最多能用几行
    for (int i=0; i<row; i++) {
        int max = (int)titles.count - i*num;
        for (int j=0; j<max; j++) {
            GZFunctionButton *button = [GZFunctionButton buttonWithType:UIButtonTypeCustom];
            button.backgroundColor = [UIColor whiteColor];
            button.frame = CGRectMake(spaceX + j*(spaceX+width), top + i*(height+spaceY), width, height);
            button.tag = 111 + i*num + j;
            [button addTarget:self action:@selector(didSetTap:) forControlEvents:UIControlEventTouchUpInside];
            button.titleLabel.font = [UIFont systemFontOfSize:16];

            [button setTitle:titles[i*num + j] forState:UIControlStateNormal];

            [button setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
            [button setTitleColor:RGBA(75, 143, 252, 1) forState:UIControlStateSelected];

            [button setImage:[UIImage imageNamed:images[i*num + j]] forState:UIControlStateNormal];
            [button setImage:[UIImage imageNamed:images_select[i*num +j]] forState:UIControlStateSelected];

            CGFloat imageWith = button.imageView.frame.size.width;
            CGFloat imageHeight = button.imageView.frame.size.height;
            CGFloat labelWidth = button.titleLabel.frame.size.width;
            CGFloat labelHeight = button.titleLabel.frame.size.height;
            button.titleEdgeInsets = UIEdgeInsetsMake(0, -imageWith, -imageHeight-top/2.0, 0); //top是图和文字的间距
            button.imageEdgeInsets = UIEdgeInsetsMake(-labelHeight-top/2.0, 0, 0, -labelWidth-imageWith-labelHeight/2.0);

            [self addSubview:button];
        }
    }
}

//设置按钮样式
- (void)setData {
    //NSArray *titles = [NSArray arrayWithObjects:@"联想输入",@"详细设置", nil];
    NSNumber *chineseAssociation = [GZUserDefaults getGroupValueForKey:@"chineseAssociation"]; //中文联想
    UIButton *button = (UIButton*)[self viewWithTag:111];
    if ([chineseAssociation isEqualToNumber:@1]) {
        button.selected = YES;
    }else {
        button.selected = NO;
    }
}


- (void)didSetTap:(UIButton*)sender {
    //NSArray *titles = [NSArray arrayWithObjects:@"联想输入",@"详细设置", nil];
    //NSArray *images = [NSArray arrayWithObjects:@"Association",@"Set", nil];
    //NSArray *images_select = [NSArray arrayWithObjects:@"Association-select",@"Set-select", nil];
    int t = (int)(sender.tag - 111);
    switch (t) {
        case 0:{
            sender.selected = !sender.selected;
            if (sender.selected) {
                [GZUserDefaults saveGroupValue:@1 forKey:@"chineseAssociation"];
            }else {
                [GZUserDefaults saveGroupValue:@0 forKey:@"chineseAssociation"];
            }
            break;
        }
        case 1:{
            if (self.sendSelectedFunc) {
                self.sendSelectedFunc(1);
            }
            break;
        }

        default:
            break;
    }
}

@end
